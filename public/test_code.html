<html>
<head>

    <link href="./stylesheets/bootstrap.css" rel="stylesheet">
    <link href="./stylesheets/test_code.css" rel="stylesheet">
<!--
    <script src="../node_modules/angular-drag-and-drop-lists/angular-drag-and-drop-lists.js"></script>
    <script src="./javascripts/boxin.js"></script>
-->
    <script data-main="javascripts/main" src="javascripts/lib/require.js"></script>
</head>
<body ng-controller="MainCtrl">


    <div class="top_trash" style=""

    >
        <ul
            ng-init="recycle_bin = []"
            dnd-list="recycle_bin"
            dnd-horizontal-list="true"
            class="list_array inline_list" style="display:inline;">
            <li style="display:inline;" ng-click="view_bin=!view_bin">
                <span class="glyphicon glyphicon-trash" style="width:100%; text-align:center; font-size: 30px; cursor: pointer;"></span>
            </li>
            <li
                ng-show="view_bin"
                ng-repeat="value in recycle_bin"
                dnd-type="value.type"
                dnd-draggable="value"
                dnd-effect-allowed="move"
                dnd-dragstart ="status.dragging = true;"
                dnd-canceled="status.dragging = false"
                dnd-moved="recycle_bin.splice($index, 1); status.dragging = false"
                ng-click="recycle_bin.splice($index,1)"
                style="display:inline; cursor: pointer;"
            >

                <div class="{{value.type}}" style="width:40px; height:40px;"></div>
            </li>
        </ul>
    </div>

    <div class="row" style="postiion:relative; top: 100px;">
        <div ng-repeat="value in value" ng-include="'/' + value.type + '.html'" class="{{value.type}}"></div>
    </div>



    <script type="text/ng-template" id="/types.html">
        <ul class="list_array ">
            <li ng-click="status.choose=false">nevermind</li>
            <li
                ng-repeat="type in categories[status.choose]"
                ng-click="types[type](status.list); status.choose = false; status.choose_category=false;"
            >
                + {{type}}
            </li>
        </ul>
    </script>

    <script type="text/ng-template" id="/categories.html">
        <ul ng-show="!status.choose" class="list_array">
            <li ng-click="status.choose_category=false">nevermind</li>
            <li
                ng-repeat="cat in cat_array"
                ng-if="allowed[cat]"
                ng-click="status.choose=cat;"
            >
                + {{cat}}
            </li>
        </ul>

        <div ng-show="!!status.choose" ng-include="'/types.html'"  ></div>
    </script>

    <script type="text/ng-template" id="/javascript.html">
        <span class="null">{{value.source}}</span>
    </script>

    <script type="text/ng-template" id="/null.html">
        <span class="null">null</span>
    </script>

    <script type="text/ng-template" id="/variable.html">
        <span
            ng-show="!value.edit || test.invalid || test.reserved || test.override_conflict || test.scopelost_conflict"
            class="variable"
            ng-click="value.edit=!value.edit"
        >{{value.name}}</span>
        <form ng-show="value.edit || value.name===''">
            <input ng-init="value.name_tmp=value.name" ng-model="value.name_tmp"</input>
            <span
                ng-show="value.edit || !test || test.invalid || test.reserved"
                ng-click="test = test_variable_name(value, current_function); value.edit=test.invalid || test.reserved || test.override_conflict || test.scopelost_conflict;"
                class="glyphicon glyphicon-ok"

                style="cursor: pointer; color: #ffffff;"></span>
            <span ng-show="test.invalid" style="cursor: pointer; color: #ff0000;">invalid</span>
            <span ng-show="test.reserved" style="cursor: pointer; color: #ff0000;">reserved</span>
            <span
                ng-show="test.scopelost_conflict || test.override_conflict"
                ng-click="test={}; value.edit=false; value.name=value.name_tmp;"
                style="cursor: pointer; color: #ff0000;"
            >ignore conflicts</span>
        </form>
    </script>


    <script type="text/ng-template" id="/boolean.html">

        <span
            ng-show="!value.edit"
            class="boolean"
            ng-click="value.edit=true"
        >{{value.value}}</span>
        <form ng-show="value.edit">
            <select ng-model="value.value">
                <option value="true">true</option>
                <option value="false">false</option>
            </select>
            <span
                ng-click="value.edit=false"
                class="glyphicon glyphicon-ok"
                style="cursor: pointer; color: #ffffff;"></span>
        </form>
    </script>

    <script type="text/ng-template" id="/number.html">

        <span
            ng-show="!value.edit"
            class="number"
            ng-click="value.edit=true"
        >{{value.value}}</span>
        <form ng-show="value.edit" ng-init="value.value_tmp=value.value">
            <input ng-model="value.value_tmp"></input>
            <span
                ng-click="test_number(value)"
                class="glyphicon glyphicon-ok"
                style="cursor: pointer; color: #ffffff;"></span>
        </form>
    </script>

    <script type="text/ng-template" id="/string.html">
        <span
            ng-show="!value.edit"
            class="string"
            ng-click="value.edit=true"
            style="white-space: pre;"
        >{{"\'" + value.value + "\'"}}</span>
        <form ng-show="value.edit">
            &#39;<input ng-model="value.value" ng-trim="false"></input>&#39;
            <span
                ng-click="value.edit=false"
                class="glyphicon glyphicon-ok"
                style="cursor: pointer; color: #ffffff;"></span>
        </form>
    </script>

    <script type="text/ng-template" id="/property.html">
    <ul
        ng-init="current_name = value.name"
        dnd-list="value.name"
        dnd-horizontal-list="true"
        dnd-disable-if="value.name.length === 1"
        dnd-allowed-types="['string']"
        dnd-inserted="value.name.splice(index, 0, item)"
        class="list_array inline_list" style="display:inline;">
        <li style="display:inline;">
            <div
                ng-show="value.name.length === 0"
                class="add"
                style="width: 5em; text-align: center;"
                ng-init="allowed = {element : true, structure : true}; status={list: value.value}"
                ng-click="types.string(value.name)"
            >+</div>
        </li>
        <li
            ng-repeat="value in value.name"
            dnd-type="value.type"
            dnd-draggable="value"
            dnd-effect-allowed="move"
            dnd-dragstart ="status.dragging = true;"
            dnd-canceled="status.dragging = false"
            dnd-moved="current_list.splice($index, 1); status.dragging = false"
            style="display:inline;"
        >

            <div ng-include="'/' + value.type + '.html'" class="{{value.type}}" ></div>
        </li>
    </ul>
        <span class="symbol" >:</span>
        <ul
            ng-init="current_list = value.value"
            dnd-list="value.value"
            dnd-horizontal-list="true"
            dnd-disable-if="value.value.length === 1"
            dnd-allowed-types="['boolean','number','string','object','array','function','evaluate','variable','reference']"
            dnd-inserted="value.value.splice(index, 0, item)"
            class="list_array inline_list" style="display:inline;">
            <li style="display:inline;">
                <div
                    ng-show="value.value.length === 0 && !status.choose_category"
                    class="add"
                    style="width: 5em; text-align: center;"
                    ng-init="allowed = {element : true, structure : true}; status={list: value.value}"
                    ng-click="status.choose_category=true"
                >+</div>
                <div ng-show="status.choose_category" ng-include="'/categories.html'" class="categories" ></div>
            </li>
            <li
                ng-repeat="value in value.value"
                dnd-type="value.type"
                dnd-draggable="value"
                dnd-effect-allowed="move"
                dnd-dragstart ="status.dragging = true;"
                dnd-canceled="status.dragging = false"
                dnd-moved="current_list.splice($index, 1); status.dragging = false"
                style="display:inline;"
            >

                <div ng-include="'/' + value.type + '.html'" class="{{value.type}}" ></div>
            </li>
        </ul>
    </script>

    <script type="text/ng-template" id="/object.html">
        <ul
            ng-init="current_list = value.properties"
            dnd-list="value.properties"
            dnd-allowed-types="['property']"
            dnd-inserted="value.properties.splice(index, 0, item)"
            class="list_array">
            <li
                ng-repeat="value in value.properties"
                dnd-type="value.type"
                dnd-draggable="value"
                dnd-effect-allowed="move"
                dnd-dragstart ="status.dragging = true;"
                dnd-canceled="status.dragging = false"
                dnd-moved="current_list.splice($index, 1); status.dragging = false"
            >
                <div ng-include="'/' + value.type + '.html'" class="{{value.type}}"></div>
            </li>
            <li>
            <div
                class="add"
                style="width: 100%; text-align: center;"
                ng-click="types.property(value.properties)"
            >+</div>

        </ul>
    </script>

    <script type="text/ng-template" id="/array.html">
        <ul
            ng-init="current_list = value.arr"
            dnd-list="value.arr"
            dnd-allowed-types="['boolean','number','string','object','array','function','evaluate','variable', 'reference']"
            dnd-inserted="value.arr.splice(index, 0, item)"
            class="list_array">
            <li
                ng-repeat="value in value.arr"
                dnd-draggable="value"
                dnd-type="value.type"
                dnd-effect-allowed="move"
                dnd-dragstart ="status.dragging = true;"
                dnd-canceled="status.dragging = false"
                dnd-moved="current_list.splice($index, 1); status.dragging = false"
            >
                <span class="symbol">{{$index}}</span> <div ng-include="'/' + value.type + '.html'" class="{{value.type}}" ></div>
            </li>
            <li>
                <div
                    ng-show="!status.choose_category"
                    class="add"
                    style="width: 100%; text-align: center;"
                    ng-init="allowed = {element : true, structure : true}; status={list: value.arr}"
                    ng-click="status.choose_category=true"
                >+</div>
                <div ng-show="status.choose_category" ng-include="'/categories.html'" class="categories" ></div>
            </li>
        </ul>
    </script>

    <script type="text/ng-template" id="/function.html">
        <div ng-init="current_function = value;" class="row">
            <span class="symbol">arguments</span>

            <ul
                ng-init="current_args = value.args"
                dnd-list="value.args"
                dnd-horizontal-list="true"
                dnd-allowed-types="['variable']"
                dnd-inserted="value.args.splice(index, 0, item)"
                class="list_array inline_list" style="display:inline;"
            >

                <li
                    ng-repeat="value in value.args"
                    dnd-type="value.type"
                    dnd-draggable="value"
                    dnd-effect-allowed="move"
                    dnd-dragstart ="status.dragging = true;"
                    dnd-canceled="status.dragging = false"
                    dnd-moved="status.dragging = false; current_args.splice($index, 1);"
                    style="display:inline;"
                >

                    <div ng-include="'/' + value.type + '.html'" class="{{value.type}}" ></div>
                </li>
                <li style="display:inline;">
                    <div
                        class="add"
                        style="width: 5em; text-align: center;"
                        ng-click="types['variable'](value.args)"
                    >+</div>
                </li>
            </ul>
        </div>
        <div class="row">
            <span class="symbol" >variables</span>
            <ul
                ng-init="current_vars = value.vars"
                dnd-list="value.vars"
                dnd-horizontal-list="true"
                dnd-allowed-types="['variable']"
                dnd-inserted="value.vars.splice(index, 0, item)"
                class="list_array inline_list" style="display:inline;"
            >

                <li
                    ng-repeat="value in value.vars"
                    dnd-type="value.type"
                    dnd-draggable="value"
                    dnd-effect-allowed="move"
                    dnd-dragstart ="status.dragging = true;"
                    dnd-canceled="status.dragging = false"
                    dnd-moved="status.dragging = false; current_vars.splice($index, 1);"
                    style="display:inline;"
                >

                    <div ng-include="'/' + value.type + '.html'" class="{{value.type}}" ></div>
                </li>
                <li style="display:inline;">
                    <div
                        class="add"
                        style="width: 5em; text-align: center;"
                        ng-click="types['variable'](value.vars)"
                    >+</div>
                </li>
            </ul>
        </div>

        <ul
            ng-init="current_list = value.sequence"
            dnd-list="value.sequence"
            dnd-allowed-types="['assign', 'evaluate', 'return']"
            class="list_array">
            <li
                ng-repeat="value in value.sequence"
                dnd-type="value.type"
                dnd-draggable="value"
                dnd-effect-allowed="move"
                dnd-dragstart ="status.dragging = true;"
                dnd-canceled="status.dragging = false"
                dnd-moved="current_list.splice($index, 1); status.dragging = false"
            >
                <div ng-include="'/' + value.type + '.html'" class="{{value.type}}"></div>
            </li>
            <li>
                <div
                    ng-show="!status.choose"
                    class="add"
                    style="width: 100%; text-align: center;"
                    ng-init="allowed = {control : true}; status={list: value.sequence}"
                    ng-click="status.choose='control'"
                >+</div>
                <div ng-show="!!status.choose" ng-include="'/types.html'" class="types" ></div>
            </li>
        </ul>
    </script>

    <script type="text/ng-template" id="/assign.html">
        <ul
            ng-init="current_variable = value.variable"
            dnd-list="value.variable"
            dnd-horizontal-list="true"
            dnd-disable-if="value.variable.length === 1"
            dnd-allowed-types="['variable','reference']"
            dnd-inserted="value.variable.splice(index, 0, item)"
            class="list_array inline_list" style="display:inline;">

            <li style="display:inline;">
                <div
                    ng-show="value.variable.length === 0 && (!status.choose || status.menu!=0)"
                    class="add"
                    style="width: 5em; text-align: center;"
                    ng-click="status.choose='assignable'; status.menu=0; status.list = value.variable"
                >+</div>
                <div ng-show="!!status.choose && status.menu==0" ng-include="'/types.html'" class="types" ></div>
            </li>
            <li
                ng-repeat="value in value.variable"
                dnd-type="value.type"
                dnd-draggable="value"
                dnd-effect-allowed="move"
                dnd-dragstart ="status.dragging = true;"
                dnd-canceled="status.dragging = false"
                dnd-moved="current_variable.splice($index, 1); status.dragging = false"
                style="display:inline;"
            >

                <div ng-include="'/' + value.type + '.html'" class="{{value.type}}" ></div>
            </li>
        </ul>
        <span class="symbol">&larr;</span>
        <ul
            ng-init="current_list = value.value"
            dnd-list="value.value"
            dnd-horizontal-list="true"
            dnd-disable-if="value.value.length === 1"
            dnd-allowed-types="['boolean','number','string','object','array','function','evaluate','variable','reference']"
            dnd-inserted="value.value.splice(index, 0, item)"
            class="list_array inline_list" style="display:inline;"
        >
            <li style="display:inline;">
                <div
                    ng-show="value.value.length === 0 && (!status.choose_category || status.menu!=1)"
                    class="add"
                    style="width: 5em; text-align: center;"
                    ng-init="allowed = {element : true, structure : true}; status={}"
                    ng-click="status.choose_category=true; status.menu=1; status.list = value.value"
                >+</div>
                <div ng-show="status.choose_category && status.menu==1" ng-include="'/categories.html'" class="categories" ></div>
            </li>
            <li
                ng-repeat="value in value.value"
                dnd-type="value.type"
                dnd-draggable="value"
                dnd-effect-allowed="move"
                dnd-dragstart ="status.dragging = true;"
                dnd-canceled="status.dragging = false"
                dnd-moved="current_list.splice($index, 1); status.dragging = false"
                style="display:inline;"
            >

                <div ng-include="'/' + value.type + '.html'" class="{{value.type}}" ></div>
            </li>
        </ul>
    </script>

    <script type="text/ng-template" id="/evaluate.html">
        <ul
            ng-init="current_list = value.variable"
            dnd-list="value.variable"
            dnd-horizontal-list="true"
            dnd-disable-if="value.variable.length === 1"
            dnd-allowed-types="['boolean','number','string','object','array','function','evaluate','variable','reference']"
            dnd-inserted="value.variable.splice(index, 0, item)"
            class="list_array inline_list" style="display:inline;">
            <li style="display:inline;">
                <div
                    ng-show="value.variable.length === 0 && (!status.choose || status.menu!=0)"
                    class="add"
                    style="width: 5em; text-align: center;"
                    ng-click="status.choose='functionable'; status.menu=0; status.list = value.variable"
                >+</div>
                <div ng-show="!!status.choose && status.menu==0" ng-include="'/types.html'" class="types" ></div>
            </li>
            <li
                ng-repeat="value in value.variable"
                dnd-type="value.type"
                dnd-draggable="value"
                dnd-effect-allowed="move"
                dnd-dragstart ="status.dragging = true;"
                dnd-canceled="status.dragging = false"
                dnd-moved="current_list.splice($index, 1); status.dragging = false"
                style="display:inline;"
            >

                <div ng-include="'/' + value.type + '.html'" class="{{value.type}}" ></div>
            </li>
        </ul>
        <span class="symbol">(&larr;)</span>
        <ul
            ng-init="current_args = value.args"
            dnd-list="value.args"
            dnd-horizontal-list="true"
            dnd-allowed-types="['boolean','number','string','object','array','function','evaluate','variable','reference']"
            dnd-inserted="value.args.splice(index, 0, item)"
            class="list_array inline_list" style="display:inline;"
        >

            <li
                ng-repeat="value in value.args"
                dnd-type="value.type"
                dnd-draggable="value"
                dnd-effect-allowed="move"
                dnd-dragstart ="status.dragging = true;"
                dnd-canceled="status.dragging = false"
                dnd-moved="current_args.splice($index, 1); status.dragging = false"
                style="display:inline;"
            >

                <div ng-include="'/' + value.type + '.html'" class="{{value.type}}" ></div>
            </li>

            <li style="display:inline;">
                <div
                    ng-show="!status.choose_category || status.menu!=1"
                    class="add"
                    style="width: 5em; text-align: center;"
                    ng-init="allowed = {element : true, structure : true}; status={}"
                    ng-click="status.choose_category=true; status.menu=1; status.list = value.args"
                >+</div>
                <div ng-show="status.choose_category && status.menu==1" ng-include="'/categories.html'" class="categories" ></div>
            </li>
        </ul>
    </script>

    <script type="text/ng-template" id="/return.html">
        <span class="symbol">return &larr;</span>
        <ul
            ng-init="current_list = value.variable"
            dnd-list="value.variable"
            dnd-horizontal-list="true"
            dnd-disable-if="value.variable.length === 1"
            dnd-allowed-types="['boolean','number','string','object','array','function','evaluate','variable','reference']"
            dnd-inserted="value.variable.splice(index, 0, item)"
            class="list_array inline_list" style="display:inline;">
            <li style="display:inline;"><div ng-show="" class="add" style="width: 5em; text-align: center;">+</div></li>
            <li style="display:inline;">
                <div
                    ng-show="value.variable.length === 0 && !status.choose_category"
                    class="add"
                    style="width: 5em; text-align: center;"
                    ng-init="allowed = {element : true, structure : true}; status={}"
                    ng-click="status.choose_category=true; status.list = value.variable"
                >+</div>
                <div ng-show="status.choose_category" ng-include="'/categories.html'" class="categories" ></div>
            </li>
            <li
                ng-repeat="value in value.variable"
                dnd-type="value.type"
                dnd-draggable="value"
                dnd-effect-allowed="move"
                dnd-dragstart ="status.dragging = true;"
                dnd-canceled="status.dragging = false"
                dnd-moved="current_list.splice($index, 1); status.dragging = false"
                style="display:inline;"
            >

                <div ng-include="'/' + value.type + '.html'" class="{{value.type}}" ></div>
            </li>
        </ul>
    </script>

    <script type="text/ng-template" id="/reference.html">
        <ul
            ng-init="current_list = value.object"
            dnd-list="value.object"
            dnd-horizontal-list="true"
            dnd-disable-if="value.object.length === 1"
            dnd-allowed-types="['object','array','function','evaluate','variable','reference']"
            dnd-inserted="value.object.splice(index, 0, item)"
            class="list_array inline_list" style="display:inline;">

            <li style="display:inline;">
                <div
                    ng-show="value.object.length === 0 && (!status.choose || status.menu!=0)"
                    class="add"
                    style="width: 5em; text-align: center;"
                    ng-click="status.choose='structure'; status.menu=0; status.list = value.object"
                >+</div>
                <div ng-show="!!status.choose && status.menu==0" ng-include="'/types.html'" class="types" ></div>
            </li>
            <li
                ng-repeat="value in value.object"
                dnd-type="value.type"
                dnd-draggable="value"
                dnd-effect-allowed="move"
                dnd-dragstart ="status.dragging = true;"
                dnd-canceled="status.dragging = false"
                dnd-moved="current_list.splice($index, 1); status.dragging = false"
                style="display:inline;"
            >

                <div ng-include="'/' + value.type + '.html'" class="{{value.type}}" ></div>
            </li>
        </ul>

        <span class="symbol">[&larr;]</span>
        <ul
            ng-init="current_list = value.prop"
            dnd-list="value.prop"
            dnd-horizontal-list="true"
            dnd-disable-if="value.prop.length === 1"
            dnd-allowed-types="['evaluate','variable','number','string','reference']"
            dnd-inserted="value.prop.splice(index, 0, item)"
            class="list_array inline_list" style="display:inline;">

            <li style="display:inline;">
                <div
                    ng-show="value.prop.length === 0 && (!status.choose || status.menu!=1)"
                    class="add"
                    style="width: 5em; text-align: center;"
                    ng-click="status.choose='keyable'; status.menu=1; status.list = value.prop"
                >+</div>
                <div ng-show="!!status.choose && status.menu==1" ng-include="'/types.html'" class="types" ></div>
            </li>
            <li
                ng-repeat="value in value.prop"
                dnd-type="value.type"
                dnd-draggable="value"
                dnd-effect-allowed="move"
                dnd-dragstart ="status.dragging = true;"
                dnd-canceled="status.dragging = false"
                dnd-moved="current_list.splice($index, 1); status.dragging = false"
                style="display:inline;"
            >

                <div ng-include="'/' + value.type + '.html'" class="{{value.type}}" ></div>
            </li>
        </ul>
    </script>


    <script type="text/ng-template" id="/if.html">
        <div>
            if
        </div>
        <div>
            <div class="row">

            </div>
            <ul>
                <li ng-repeat="cond in value.conditions">
                    <ul
                        ng-init="current_list = value.conditions"
                        dnd-list="value.conditions"
                        dnd-allowed-types="['assign', 'evaluate', 'return']"
                        class="list_array">
                        <li
                            ng-repeat="value in value.then"
                            dnd-type="value.type"
                            dnd-draggable="value"
                            dnd-effect-allowed="move"
                            dnd-dragstart ="status.dragging = true;"
                            dnd-canceled="status.dragging = false"
                            dnd-moved="current_list.splice($index, 1); status.dragging = false"
                        >
                            <div ng-include="'/' + value.type + '.html'" class="{{value.type}}"></div>
                        </li>
                        <li>
                            <div
                                ng-show="!status.choose"
                                class="add"
                                style="width: 100%; text-align: center;"
                                ng-init="allowed = {control : true}; status={list: value.sequence}"
                                ng-click="status.choose='control'"
                            >+</div>
                            <div ng-show="!!status.choose" ng-include="'/types.html'" class="types" ></div>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </script>


</body>
</html>
